# kanban

Канбан доски.

## ИоТерра‑Канбан (PostgreSQL + Node/Express + React/Vite)

Веб‑приложение Kanban‑доски с карточками, участниками, вложениями, ролями, 2FA и несколькими досками.

### Быстрый старт (рекомендуется): всё в контейнерах

```bash
./run_one_app.sh
```

После запуска:

- **UI**: `https://localhost:8443`
- **Adminer**: `https://localhost:8443/adminer/`

HTTP отключён — приложение работает **только по HTTPS** (самоподписанный сертификат создаётся автоматически в `./certs/`).

### Вход в систему

- **По умолчанию** при первом запуске есть пользователь:
  - **логин**: `admin`
  - **пароль**: `admin`
- При первом входе требуется **сменить пароль**.
- В системе включена **2FA (TOTP)**: после входа настройте 2FA в **Кабинете**.

### Основные возможности

- **Колонки**: Backlog → High priority → ToDo → In Progress → Ready For Acceptance → Done
- **Карточка**:
  - описание/детали
  - ответственный
  - срок (дата+время)
  - метки (важность + пауза)
  - комментарии (история)
  - вложения (загрузка/скачивание/удаление)
  - участники карточки
- **Drag‑and‑drop** перемещение карточек между колонками
- **Несколько досок** + выбор доски по умолчанию
- **Роли**:
  - **Администратор**: управление пользователями и досками
  - **Участник**: работа с карточками в доступных досках
- **Права на комментарии**:
  - участник может редактировать/удалять **только свои** комментарии
  - администратор может управлять любыми
- **Аватары**:
  - пресеты + загрузка фото (в Кабинете)

### Кабинет

Кнопка **«Кабинет»** в верхней панели:

- изменение имени/почты (если допустимо) и доски по умолчанию
- настройка 2FA
- управление аватаром (пресет/фото)

Для администратора внутри кабинета есть блок **«Администрирование»**:

- **Доски**: создание/редактирование/удаление (кроме основной), описание, участники доски
- **Пользователи**: создание, удаление (кроме системного администратора), смена роли, сброс пароля
- **Почта**: включение/выключение уведомлений и параметры SMTP + кнопка **«Проверить соединение»**

### Уведомления по почте и восстановление пароля по почте

Функциональность email‑уведомлений и восстановления пароля **оставлена**, но работает только если администратор включил и настроил почту:

**Кабинет → Администрирование → Почта**

- включите **«Использовать уведомления по почте»**
- заполните SMTP параметры
- нажмите **«Проверить соединение»**

Если почта выключена или не настроена:

- уведомления по карточкам не отправляются
- восстановление пароля по почте не выполняется

### Восстановление пароля без почты

Если почта недоступна, есть альтернативы:

- **по коду 2FA**: на экране входа **«Забыли пароль?»** → логин/email + код 2FA + новый пароль
- **через администратора**: Админ → **Пользователи** → кнопка с ключом (сброс пароля, при входе потребуется смена)

### Переменные окружения и секреты

`run_one_app.sh` использует два файла:

- `docker/compose/.cont_one_app.env` — **не секреты**
- `docker/compose/.cont_one_app.secrets.env` — **секреты** (не коммитить)

### Локальная разработка (без контейнеров)

1) Поднять PostgreSQL:

```bash
docker compose up -d db
```

2) Backend:

```bash
cd backend
npm install
npx prisma generate
npx prisma migrate dev
npm run dev
```

3) Frontend:

```bash
cd frontend
npm install
npm run dev
```

### Тесты

```bash
npm run test
```

Отдельно:

```bash
npm run test -w backend
npm run test -w frontend
```
